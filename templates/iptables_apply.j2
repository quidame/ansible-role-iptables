*filter

:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

-I INPUT -p tcp -m tcp --dport {{ ansible_port|default(22) }} -m comment --comment "SSH" -j ACCEPT
-I INPUT -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -m comment --comment "bad NEWs" -j DROP
-I INPUT -p tcp -m tcp --sport :1023 -m comment --comment "bad source port" -j DROP
-I INPUT -p udp -m udp --sport :1023 -m comment --comment "bad source port" -j DROP
-I INPUT -p icmp -m comment --comment "ICMP" -j ACCEPT
-I INPUT -i lo -m comment --comment "loopback" -j ACCEPT
-I INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-I INPUT -m conntrack --ctstate INVALID -j DROP

-I OUTPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-I OUTPUT -m conntrack --ctstate INVALID -j DROP

COMMIT
